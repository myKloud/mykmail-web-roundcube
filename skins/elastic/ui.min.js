"use strict";function rcube_elastic_ui(){var e,t,a,n,i,o,s,r,l,c,d,u,p,m,h,f,v=this,g="normal",b="light",_=!1,k=!1,w=rcmail.is_framed(),x={config:{standard_windows:rcmail.env.standard_windows,message_extwin:rcmail.env.message_extwin,compose_extwin:rcmail.env.compose_extwin,help_open_extwin:rcmail.env.help_open_extwin},checkboxes:0,small_screen_config:{standard_windows:!0,message_extwin:!1,compose_extwin:!1,help_open_extwin:!1}},C={},y=[],E=[],T={menu:$("#layout-menu"),sidebar:$("#layout-sidebar"),list:$("#layout-list"),content:$("#layout-content")},L={menu:$("a.task-menu-button"),back_sidebar:$("a.back-sidebar-button"),back_list:$("a.back-list-button"),back_content:$("a.back-content-button")};function j(e,t,a,n){var i=!0,o=$("<a>"),s=e.attr("id")||(new Date).getTime(),r=s+"-clone",l=e[0].className+(a?" "+a:"");return t?(a=e.data("popup"))&&(o.data({popup:a,"toggle-button":e.data("toggle-button")}),G(o[0]),i=!1,rcmail.register_menu_button(o[0],a)):(l=l.replace("btn-primary","primary").replace(/(btn[a-z-]*|button|disabled)/g,"").trim(),l+=" button"+(n?"":" disabled")),o.attr({id:r,href:"#",class:l}).append($('<span class="inner">').text(e.text())),i&&o.on("click",function(t){e.click()}),w&&!t?(o.data("target",e),E.push($.extend({button_id:r},z(e[0].id)))):(s=s,r=r,l=l.replace(" disabled",""),(s=z(s))&&rcmail.register_button(s.command,r,s.data.type,l,s.data.sel)),o}function z(e){var t,a,n;for(n in rcmail.buttons)for(t=0;t<rcmail.buttons[n].length;t++)if((a=rcmail.buttons[n][t]).id==e)return{command:n,index:t,data:a}}function M(){function e(e){"phone"==g&&rcmail.display_message(rcmail.gettext(e),"confirmation")}var t,a;$("[data-list]").filter("ul,table").each(function(){var e,t,a,n,i,o=$(this),s=o.data("list");rcmail[s]&&rcmail[s].multiselect&&((a=(t=(e=o.parents("layout-sidebar,#layout-list,#layout-content").last()).find(".header")).find("ul")).length?(i=a.find("a.select").data("toggle-button"))&&(i=$("#"+i)):a=t,rcmail[s].enable_checkbox_selection(),!0===ge("list-selection")&&o.addClass("withselection"),i||(i=$("<a>").attr({class:"button selection disabled",role:"button",title:rcmail.gettext("select")}).on("click",function(){UI.toggle_list_selection(this,o.attr("id"))}).append($('<span class="inner">').text(rcmail.gettext("select"))),a.is(".menu")?(i.prependTo(a).wrap('<li role="menuitem">'),T.content&&(n=j(i,!0,"hidden-big hidden-large"),$('<li role="menuitem">').append(n).appendTo("#toolbar-menu"),i=i.add(n))):(n=o.data("list-select-replace"))?$(n).replaceWith(i):(i.appendTo(a).addClass("icon"),e.is("#layout-sidebar")||i.addClass("toolbar-button"))),rcmail.addEventListener("listupdate",function(e){e.list&&e.list==rcmail[s]&&(e.rowcount?i.addClass("active").removeClass("disabled").attr("tabindex",0):i.removeClass("active").addClass("disabled").attr("tabindex",-1))})),_&&rcmail[s]&&("function"==typeof rcmail[s].draggable?rcmail[s].draggable("destroy"):"boolean"==typeof rcmail[s].draggable&&(rcmail[s].draggable=!1),rcmail[s].dblclick_time=0)}),window.MutationObserver&&$("[data-label-msg]").filter("ul,table").each(function(){var e=$('<div class="listing-info hidden">').insertAfter(this),t=$(this),a=function(){var a,n=t.data("label-msg"),i=t.is("ul")?t:t.children("tbody");if(!rcmail.env.search_request&&!rcmail.env.qsearch&&n&&!i.children(":visible").length)return a=t.data("label-ext"),i=t.data("create-command"),!a||i&&!rcmail.commands[i]||(n+=" "+a),void e.text(n).removeClass("hidden");e.addClass("hidden")},n=function(){if(rcmail.busy||!t.is(":visible"))return setTimeout(n,250);clearTimeout(x.list_timer),x.list_timer=setTimeout(a,50)};new MutationObserver(n).observe(t[0],{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),n()}),"print"!=rcmail.env.action&&$("#attachment-list > li").each(function(){ne(this)}),rcmail.addEventListener("fileappended",function(t){t.attachment.complete&&(ne(t.item),"text/vcard"==t.attachment.mimetype&&rcmail.commands["attach-vcard"]&&e("vcard_attachments.vcardattached"))}).addEventListener("managesieve.insertrow",function(e){O(e.obj)}).addEventListener("add-recipient",function(){e("recipientsadded")}),rcmail.init_pagejumper(".pagenav > input"),"mail"==rcmail.task?("compose"==rcmail.env.action&&(rcmail.addEventListener("compose-encrypted",function(e){$("a.mode-html, button.attach").prop("disabled",e.active),$("a.attach, a.responses:not(.edit)")[e.active?"addClass":"removeClass"]("disabled")}),$("#layout-sidebar > .footer:not(.pagenav) > a.button").click(function(){$(this).is(".disabled")&&rcmail.display_message(rcmail.gettext("nocontactselected"),"warning")}),window.MutationObserver&&(t=$("#attachment-list"),a=function(){te("attach",0<t.children().length)},new MutationObserver(a).observe(t[0],{childList:!0}),a())),rcmail.env.extwin||"compose"!=rcmail.env.action&&"show"!=rcmail.env.action||$("a.mail",T.menu).attr({"aria-disabled":!1,onclick:"return rcmail.command('list','',this,event);"}),"preview"!=rcmail.env.action&&"show"!=rcmail.env.action||($("a").filter('[href^="mailto:"]').each(function(){var e,t;t=(e=this).onclick,e.onclick=null,$(e).on("click",function(a,n){return n||ie($("#mailto-menu"),e,a,t)})}),ee())):"settings"==rcmail.task&&(rcmail.addEventListener("identity-encryption-show",function(e){O(e.container)}),rcmail.addEventListener("identity-encryption-update",function(e){O(e.container)})),rcmail.set_env({thread_padding:"1.5rem",popup_width_small:1025,popup_width:1200}),rcmail.env.devel_mode&&window.less?less.pageLoadFinished.then(function(){R(),rcmail.env.compose_focus_elem&&$(rcmail.env.compose_focus_elem).focus()}):R();var n,i=rcmail.env.date_format_localized;i&&(n=function(e){$(e).filter(".datepicker").attr("placeholder",i),$(e).parent().find("select").each(function(){de(this)})},$("input.datepicker").each(function(){n(this)}),rcmail.addEventListener("insert-edit-field",n))}function O(e){var t,a,n;e=e||document,$("input.button,button",e).not(".btn").addClass("btn").not(".btn-primary,.primary,.mainaction").addClass("btn-secondary"),$("input.button.mainaction,button.primary,button.mainaction",e).addClass("btn-primary"),$("button.btn.delete,button.btn.discard",e).addClass("btn-danger"),$.each(["warning","error","information","confirmation"],function(){var t=this;$(".box"+t+":not(.ui.alert)",e).each(function(){K(this,t,!0)})}),e!=document&&1==$(".popup",e).children().length&&((n=$(".popup",e).children().first()).is("img")?$(".popup",e).addClass("justified"):n.is("label")&&(t=n.find("input").detach(),a=n.detach(),(n=t.attr("id"))||t.attr("id",n="dialog-input-elastic"),$(".popup",e).addClass("formcontent").append($('<div class="form-group row">').append(a.attr("for",n).addClass("col-sm-2 col-form-label")).append($('<div class="col-sm-10">').append(t))),t.focus()));var i="input:not(.button,.no-bs,[type=button],[type=radio],[type=checkbox],[type=file]),textarea";$(i,$(".propform",e)).addClass("form-control"),$("[type=checkbox]",$(".propform",e)).addClass("form-check-input"),$("select",e).addClass("form-control custom-select"),e!=document&&$(i,e).addClass("form-control"),$("table.propform",e).each(function(){var e=0,t=0,a=["sm",4,8];$(this).attr("class").match(/cols-([a-z]+)-(\d)-(\d)/)&&(a=[RegExp.$1,RegExp.$2,RegExp.$3]),$(this).find("> tbody > tr, > tr").each(function(){var n,i,o=$(this),s=["form-group","row"],r=o.children("td");2==r.length?(n=r.first(),i=r.last(),$("label",n).addClass("col-form-label"),n.addClass("col-"+a[0]+"-"+a[1]),i.addClass("col-"+a[0]+"-"+a[2]),1!=i.find("[type=checkbox]").length||i.find(".proplist").length?i.find("input:not([type=hidden]),textarea,radio,select").length?t++:(i.addClass("form-control-plaintext"),e++):(s.push("form-check"),i.find("a").length&&s.push("with-link"),t++),i.children(".datepicker")&&2==i.children("input").length&&i.addClass("datetime")):1==r.length&&r.css("width","100%"),o.addClass(s.join(" "))}),t<e&&$(this).addClass("text-only")}),$("td.input-group",e).each(function(){$(this).children().slice(1).addClass("input-group-append")}),$("fieldset.propform:not(.grouped) div.row",e).each(function(){var e=0<$("input:not([type=hidden]),select,textarea",this).length;e&&$(i,this).addClass("form-control"),$(this).children().last().addClass("col-sm-8"+(e?"":" form-control-plaintext")),$(this).children().first().addClass("col-sm-4 col-form-label"),$(this).addClass("form-group")}),$("fieldset.propform.grouped fieldset",e).each(function(){$(".row",this).each(function(){var e,t=0<$("input,select,textarea",this).length,a=$(this).children();t&&$(i,this).addClass("form-control"),a.length<2||((e=a.first()).is("select")?e.addClass("input-group-prepend"):e.wrap('<span class="input-group-prepend">').addClass("input-group-text"),t||a.last().addClass("form-control-plaintext"),$(".content",this).addClass("input-group-prepend input-group-append input-group-text"),$("a.deletebutton",this).addClass("input-group-text icon delete").wrap('<span class="input-group-append">'),$(this).addClass("input-group"))})}),$("fieldset.advanced",e).each(function(){var e=$(this).children(".propform").first();e.wrap($("<div>").addClass("collapse")),$(this).children("legend").first().addClass("closed").on("click",function(){e.parent().collapse("toggle"),$(this).toggleClass("closed")})}),$(".propform > .prop.block:not(.row)",e).each(function(){$(this).addClass("form-group row").each(function(){$("label",this).addClass("col-form-label").wrap($('<div class="col-sm-4">')),$("input,select,textarea",this).wrap($('<div class="col-sm-8">')),$(i,this).addClass("form-control")})}),$("td.rowbuttons > a",e).addClass("btn"),$("form.tabbed,div.tabbed",e).each(function(e,t){var a=[],n=$("<ul>").attr({class:"nav nav-tabs",role:"tablist"});$(this).addClass("tab-content").children("fieldset").each(function(t,n){var i=n.id||"tab"+e+"-"+t;t=$(n).data("navlink-class");$(n).addClass("tab-pane").attr({id:i,role:"tabpanel"}),i=$("<li>").addClass("nav-item").append($("<a>").addClass("nav-link"+(t?" "+t:"")).attr({role:"tab",href:"#"+i}).text($("legend",n).first().text()).click(function(e){return $(this).tab("show"),J(e),!1})),$("legend",n).first().hide(),a.push(i)}),n.append(a).insertBefore(t),$("a.nav-link",n).first().click()}),$("input[type=file]:not(.custom-file-input)",e).each(function(){var e=rcmail.gettext("choosefile"+(this.multiple?"s":"")),t=$("<label>").attr({class:"custom-file-label","data-browse":rcmail.gettext("browse")}).text(e);$(this).addClass("custom-file-input").wrap('<div class="custom-file">'),$(this).on("change",function(){var t=e;this.files.length&&(t=this.files[0].name,1<this.files.length&&(t+=", ...")),$(this).next().text(t)}).parent().append(t)}),$("table:not(.table,.compact-table,.propform,.listing,.ui-datepicker-calendar)",e).filter(function(){return!$(this).parent().is(".propform")&&!$(this).parents("#message-header,.message-htmlpart,.message-partheaders,.boxinformation,.raw-tables").length}).each(function(){var e=$(this).addClass("table");e.parent().addClass("table-responsive-sm"),e.find("thead").addClass("thead-default")}),$("input.pretty-checkbox, .propform input[type=checkbox], .form-check input[type=checkbox], .popupmenu.form input[type=checkbox], .menu input[type=checkbox]",e).each(function(){le(this)}),$(e).is(".actionrow")&&$("input[type=checkbox]",e).each(function(){le(this)}),$(".input-group-combo > select",e).first().on("change",function(){function e(){t[t.next().is(":visible")?"removeClass":"addClass"]("alone")}var t=$(this);setTimeout(e,50),setTimeout(e,2e3)}).trigger("change"),$("#message-objects",e).children(":not(.ui.alert)").add(".part-notice").each(function(){var e=String($(this).removeClass("notice part-notice").attr("class")).split(/\s/)[0]||"warning";K(this,e),$(this).addClass("box"+e),$("a",this).addClass("btn btn-primary btn-sm")}),$(".error",e).addClass("is-invalid"),"login"==rcmail.env.task&&e==document&&($("#rcmloginsubmit").addClass("btn-lg text-uppercase w-100"),$("#rcmloginoauth").addClass("btn btn-secondary btn-lg w-100"),$("#login-form table tr").each(function(){var e=$("input,select",this),t=$("label",this),a=e.data("icon"),n=$("<i>").attr("class","input-group-text icon "+e.attr("name").replace("_",""));a&&n.addClass(a),$(this).addClass("form-group row"),t.parent().css("display","none"),e.addClass(e.is("select")?"custom-select":"form-control").attr("placeholder",t.text()).before($('<span class="input-group-prepend">').append(n)).parent().addClass("input-group input-group-lg")})),$("select:not([multiple])",e).each(function(){de(this)})}function S(e){var t,a,n,i=[],o=$("#"+e.id).parent().is(".html-editor");e.config.plugins+=" autoresize",ve()&&(e.config.toolbar="undo redo | link image styleselect"),"mail"==rcmail.task&&"compose"==rcmail.env.action&&(t=!1,a=$("#compose-content > form"),n=function(e){"Tab"==e.key&&e.shiftKey&&$("#compose-content > form").scrollTop(0)},i.push(function(e){e.on("keypress",n)}),$("#composebody").on("keypress",n),a.on("scroll",function(){var e=$(".tox-editor-container",a),n=e.find(".tox-toolbar-overlord"),i=e.offset(),o=a.offset().top;i&&i.top-o<0?(n.css({position:"fixed",top:o+"px",width:e.width()+"px"}),t=!0):(t&&($("#compose-subject").focus(),t=!1),n.css({position:"relative",top:0,width:"auto"}))}),$(window).resize(function(){a.trigger("scroll")})),o&&(e.config.toolbar="plaintext | "+e.config.toolbar,e.config.setup_callback=function(e){e.ui.registry.addButton("plaintext",{tooltip:rcmail.gettext("plaintoggle"),icon:"close",onAction:function(t){rcmail.command("toggle-editor",{id:e.id,html:!1},"",t.originalEvent)&&$("#"+e.id).parent().removeClass("ishtml")}})}),i.push(function(e){e.on("OpenWindow",function(e){function t(e){var t=$(a).find(".tox-dialog__body"),n=$(a).find(".tox-dialog__footer").find("button");e||(4===n.length?t.closest(".tox-dialog").addClass("tox-search-dialog"):2==n.length&&n.first().insertAfter(n[1])),t.find(".tox-checkbox > input").each(function(){le(this)}),t.find(".tox-textarea,.tox-textfield").addClass("form-control")}var a=$(".tox-dialog:last")[0];window.MutationObserver&&new MutationObserver(t).observe($(".tox-dialog__body-content",a)[0],{childList:!0}),t()})}),rcmail.addEventListener("editor-load",function(e){$.each(i,function(){this(e.ref.editor)})})}function D(e){var t;$("ul",e.obj).addClass("menu listing iconized"),$(e.obj).addClass("popupmenu popover"),O(e.obj),$("input",e.obj).addClass("form-control"),fe()&&$(e.obj).is(".googie_window")&&(t=rcmail.gettext("close"),t=$("<a>").attr("class","button icon cancel").text(t).click(function(t){t.stopPropagation(),$(".popover-overlay").remove(),$(e.obj).hide()}),$('<h3 class="popover-header">').append(t).prependTo(e.obj),$(".popover-overlay").length||$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$("ul,button",e.obj).click(function(e){$(e.target).is("input")||$(".popover-overlay").remove()}))}function I(e){if(w&&$.each(E,function(t,a){e.command==a.command&&parent.$("#"+a.button_id)[e.status?"removeClass":"addClass"]("disabled")}),"mail"==rcmail.task)switch(e.command){case"reply-list":var t;1==rcmail.env.reply_all_mode&&(t=rcmail.gettext(e.status?"replylist":"replyall"),$(".toolbar a.reply-all").attr("title",t).find(".inner").text(t));break;case"compose-encrypted":$(".toolbar a.encrypt").parent().show();break;case"compose-encrypted-signed":$("#encryption-menu-button").show()}}function A(){var e=$(window).width();_=e<=1024,g=e<=480?"phone":1200<e?"large":768<e?"normal":"small"}function R(){var e;A(),N(),function(){var e=he(),t=$(document.documentElement);t[0].className.match(/layout-([a-z]+)/)?RegExp.$1!=e.mode&&t.removeClass("layout-"+RegExp.$1).addClass("layout-"+e.mode):t.addClass("layout-"+e.mode),e.touch&&!t.is(".touch")?t.addClass("touch"):!e.touch&&t.is(".touch")&&t.removeClass("touch")}(),(e=fe())?(rcmail.set_env(x.small_screen_config),rcmail.enable_command("extwin",!1)):(rcmail.set_env(x.config),rcmail.enable_command("extwin",!0)),$.each(y,function(){$(this)[e?"hide":"show"]()}),rcmail.triggerEvent("skin-resize",{mode:g})}function N(){if(!w||T.sidebar.length||T.list.length){switch(g){case"phone":U(),F(!1);break;case"small":U(),F(!0);break;case"normal":T.list.length&&(e=T.list.is(x.last_selected)||!T.sidebar.is(x.last_selected)&&!T.sidebar.is(".layout-sticky"),T.list[e?"removeClass":"addClass"]("hidden")),T.sidebar.length&&(e=!T.list.length||T.sidebar.is(x.last_selected)||T.sidebar.is(".layout-sticky"),T.sidebar[e?"removeClass":"addClass"]("hidden")),T.content.removeClass("hidden"),F(!0),q(),T.list.length&&$(".header > ul.menu",T.list).addClass("popupmenu");break;case"large":$.each(T,function(e,t){t.removeClass("hidden")}),q(),T.list&&$(".header > ul.menu.popupmenu",T.list).removeClass("popupmenu")}P(g),W(),bw.webkit&&bw.ipad&&bw.agent.match(/OS 9/)&&$(".iframe-wrapper").each(function(){var e=$(this).height();e&&$(this).children("iframe").height(e)})}else W();var e}function P(e){var t=rcmail.env.additional_logos;t&&($("#logo").data("src-default")||$("#logo").data("src-default",$("#logo").attr("src")),"phone"==e&&t.small?$("#logo").attr("src",t.small):"phone"==e&&"dark"==b&&t["small-dark"]?$("#logo").attr("src",t["small-dark"]):"dark"==b&&t.dark?$("#logo").attr("src",t.dark):$("#logo").attr("src",$("#logo").data("src-default")))}function W(){$("#layout > div > .header").each(function(){var e,t=0,a=0,n={left:0,right:0};$(this).children(":visible:not(.position-absolute)").each(function(){e||!$(this).is(".header-title")?n[e?"right":"left"]+=this.offsetWidth:e=$(this)}),0+n.right>=n.left?a=n.right+(t=0)-n.left:t=n.left-((a=0)+n.right),$(e).css({"margin-right":t+"px","margin-left":a+"px","padding-right":"0px"})})}function U(){var e,t=!1;T.content.length&&(e=t=T.content.is(x.last_selected),T.content[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",T.content).addClass("popupmenu")),T.list.length&&(e=!t&&T.list.is(x.last_selected),T.list[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",T.list).addClass("popupmenu")),T.sidebar.length&&(e=!t&&(T.sidebar.is(x.last_selected)||!T.list.length),T.sidebar[e?"removeClass":"addClass"]("hidden")),t&&L.back_list.show()}function q(){L.back_list.filter(function(){return 0==$(this).parents("#layout-sidebar").length}).hide(),$("ul.menu.popupmenu").removeClass("popupmenu")}function H(e){T.list.addClass("hidden"),T.sidebar.removeClass("hidden"),e&&T.sidebar.addClass("layout-sticky"),"small"!=g&&"phone"!=g||T.content.addClass("hidden"),W(),x.last_selected=T.sidebar[0]}function B(e){T.list.length||T.sidebar.length?(T.sidebar.addClass("hidden").removeClass("layout-sticky"),T.list.removeClass("hidden"),"small"!=g&&"phone"!=g||(x.last_selected=T.list[0]||T.sidebar[0],N(),rcmail.show_contentframe(!1),$("[data-list]",T.list).each(function(){var e=$(this).data("list");rcmail[e]&&(rcmail[e].clear_selection?rcmail[e].clear_selection():rcmail[e].select&&rcmail[e].select())})),e&&T.list.children(".scroller").scrollTop(0),x.last_selected=T.list[0]):history.back(),W()}function F(e){e?("phone"==g&&($('<div id="menu-overlay" class="popover-overlay">').on("click",function(){F(!1)}).appendTo("body"),x.menu_initialized||(x.menu_initialized=!0,$("a",T.menu).on("click",function(e){"phone"==g&&F()})),T.menu.addClass("popover")),T.menu.removeClass("hidden")):($("#menu-overlay").remove(),T.menu.addClass("hidden").removeClass("popover"))}function Y(e){"loading"==e.type&&$(".iframe-loader:visible").length?rcmail.hide_message(e.object):(K(e.object,e.type,!0),$(e.object).attr("role","alert"))}function K(e,t,a){var n="ui alert",i=!$(e).is(".noicon");a&&i&&!$(e).is(".aligned-buttons")&&$(e).html($("<span>").html($(e).html())),(t={information:"alert-info",notice:"alert-info",confirmation:"alert-success",warning:"alert-warning",error:"alert-danger",loading:"alert-info loading",uploading:"alert-info loading",vcardattachment:"alert-info"}[t=t.split(" ")[0]])&&(n+=" "+t,i&&$("<i>").attr("class","icon").prependTo(e)),$(e).addClass(n)}function V(e){function t(){$(e).is(".open")&&i.click()}function a(){$(e)[o.val()||"mail"==rcmail.task&&$("#s_interval").val()||rcmail.gui_objects.search_filter&&"ALL"!=$(rcmail.gui_objects.search_filter).val()||rcmail.gui_objects.foldersfilter&&"---"!=$(rcmail.gui_objects.foldersfilter).val()?"addClass":"removeClass"]("active"),n[rcmail.gui_objects.search_filter&&"UNSEEN"==$(rcmail.gui_objects.search_filter).val()?"addClass":"removeClass"]("selected")}var n=$(),i=$("a.button.options",e),o=$("input:not([type=hidden])",e),s=o.attr("placeholder");$("form",e),o.is("#mailsearchform")&&(n=$("<a>").attr({class:"button unread",href:"#",role:"button",title:rcmail.gettext("showunread")}).on("click",function(e){$(rcmail.gui_objects.search_filter).val($(e.target).is(".selected")?"ALL":"UNSEEN"),rcmail.command("search")}).insertBefore(i)),i.on("click",function(t){var n=$(this).data("target"),o=$("#"+n),s=$(e).is(".open");o.length&&(s||(v[n]?v[n](o.get(0),this,t):"function"==typeof window[n]&&window[n](o.get(0),this,t)),o.next()[s?"show":"hide"](),o.toggleClass("hidden"),$(".floating-action-buttons").toggleClass("hidden"),$(e).toggleClass("open"),$("button.search",o).off("click.search").on("click.search",function(){i.click(),a()}))}),o.on("input change",a).on("focus blur",function(e){o.attr("placeholder","blur"==e.type?s:"")}),$("a.reset",e).on("click",function(t){o.val("").change().trigger("keyup.treelist",{keyCode:27}),$(e).is(".open")&&i.click(),rcmail.gui_objects.search_filter&&$(rcmail.gui_objects.search_filter).val("ALL"),rcmail.gui_objects.foldersfilter&&($(rcmail.gui_objects.foldersfilter).val("---").change(),rcmail.folder_filter("---")),a()}),rcmail.addEventListener("init",a).addEventListener("responsebeforesearch",a).addEventListener("beforelist",t).addEventListener("afterlist",a).addEventListener("beforesearch",t)}function G(e,t){if(w&&fe())return parent.UI.popup_init(e,t||window);t=t||window;var a,n=$(e).data("popup"),i=$(t.$("#"+n).get(0)),o=i,s=$(e).attr("title");$(e).attr({"aria-haspopup":"true","aria-expanded":"false","aria-owns":n}).popover({content:function(){return t!=window&&(i=o.clone(!0,!0)).attr("id",n+"-clone").appendTo(document.body).find("li > a").attr("onclick","").off("click").on("click",function(a){return $(this).is(".disabled")||($(e).popover("hide"),t.$("#"+$(this).attr("id")).click()),!1}),i.get(0)},trigger:$(e).data("popup-trigger")||"click",placement:$(e).data("popup-pos")||"bottom",animation:!0,boundary:"window",html:!0}).on("show.bs.popover",function(o){var s=i.data("popup-init");n&&C[n]&&(C[n].transitioning=!0),s&&v[s]?v[s](i.get(0),e,o):s&&t[s]&&t[s](i.get(0),e,o),a=$("div.popover:visible").length+1,i.removeClass("hidden").attr("aria-hidden",!1).find('[aria-haspopup="true"]').data("level",a+1).off("click.popup").on("click.popup",function(e){e.stopPropagation()}),fe()||i.css("max-height",Math.min(539,$(window).height()-30))}).on("shown.bs.popover",function(t){var i,o,s=fe(),r=$("#"+$(e).attr("aria-describedby"));a=$(e).data("level")||1,s&&(o=1<a?"back":"close",i=rcmail.gettext(o),o="button icon "+("back"==o?"back":"cancel"),$(".popover-header",r).empty().append($("<a>").attr("class",o).text(i).on("click",function(t){$(e).popover("hide"),1<a&&t.stopPropagation()}).on("mousedown",function(e){e.stopPropagation()}))),$.each(C,function(e,t){$(t.target).data("level")==a&&e!=n&&X(e)}),"key"==$(e).data("event")&&(r.off("keydown.popup").on("keydown.popup","a.active",function(t){var a,n,i="next";switch(t.which){case 27:case 9:return $(e).popover("toggle").focus(),!1;case 38:case 63232:i="previous";case 40:case 63233:for(a=t.target.parentNode;a=a[i+"Sibling"];)if(n=$(a).children(".active")[0]){n.focus();break}return!1}}),r.find("a.active").first().focus()),n&&C[n]&&(C[n].transitioning=!1),s&&!$(".popover-overlay").length&&$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$(".popover-body",r).addClass("webkit-scroller")}).on("hide.bs.popover",function(){1==a&&$(".popover-overlay").remove(),n&&C[n]&&i.is(":visible")&&(C[n].transitioning=!0)}).on("hidden.bs.popover",function(){/-clone$/.test(i.attr("id"))?i.remove():i.attr("aria-hidden",!0).addClass("hidden").appendTo(i.data("popup-parent")||document.body),$(".popover-body:empty").each(function(){$(this).parent().remove()}),n&&C[n]&&delete C[n]}).on("click",function(){$(this).data("event","mouse")}).on("keydown",function(e){if(e.originalEvent)switch(e.originalEvent.which){case 13:case 32:e.preventDefault(),$(this).data("event","key").popover("toggle");break;case 27:$(this).popover("hide")}}),s&&$(e).attr("title",s),i.attr("aria-hidden","true").data("button",e),i.data("editable")&&i.on("click mousedown",function(e){e.stopPropagation()})}function J(e){t&&t>(new Date).getTime()-250||$(".popover.show").each(function(){var t=$(".popover-body",this).children().first().data("button");t&&e.target!=t&&!$(t).find(e.target).length&&"string"!=typeof t&&$(t).popover("hide"),t||$(this).remove()})}function Q(e){if(e&&e.name&&(!e.props||!1!==e.props.skinable)){if(w&&fe())return e.win||(e.win=window),parent.UI.menu_toggle(e);if("messagelistmenu"==e.name)!function(){var e=$("#listoptions-menu"),t=(e.width(),e.clone(!0));$('select[name="sort_col"]',t).val(rcmail.env.sort_col||""),$('select[name="sort_ord"]',t).val(rcmail.env.sort_order||"ASC"),$('select[name="mode"]',t).val(rcmail.env.threading?"threads":"list"),$("select",t).each(function(){this.id=this.id+"-clone"}),$("label",t).each(function(){$(this).attr("for",$(this).attr("for")+"-clone")}),t=rcmail.simple_dialog(t,rcmail.gettext("listoptionstitle"),function(e){rcube_event.is_keyboard(e.originalEvent)&&$("#listmenulink").focus();var a=$('select[name="sort_col"]',t).val(),n=$('select[name="sort_ord"]',t).val();e=$('select[name="mode"]',t).val();return rcmail.set_list_options([],a,n,"threads"==e?1:0),!0},{closeOnEscape:!0,minWidth:400})}();else if("menu-open"==e.event){var t,a,n=$("ul",e.obj).first(),i=e.props&&e.props.link?e.props.link:e.originalEvent.target;if(!n.length)return;$(i).is("span")&&(i=$(i).parents("a,li")[0]),e.name.match(/^drag/)&&(a=rcube_event.get_mouse_pos(e.originalEvent),i=$("<a>").css({position:"absolute",left:a.x,top:a.y,height:"1px",width:"1px",visibility:"hidden"}).appendTo(document.body).get(0)),a=$(i).data("popup-pos")||"right","folder-selector"==e.name?n.addClass("listing folderlist"):"addressbook-selector"==e.name||"contactgroup-selector"==e.name?n.addClass("listing contactlist"):n.hasClass("menu")&&n.addClass("listing"),"pagejump-selector"==e.name&&(n.addClass("simplelist"),e.obj.addClass("simplelist"),a="top"),C[e.name]&&X(e.name,e.originalEvent),(t=function(){if(C[e.name]&&C[e.name].transitioning)return setTimeout(t,50);$(i).data("popup")||($(i).data({event:rcube_event.is_keyboard(e.originalEvent)?"key":"mouse",popup:e.name,"popup-pos":a,"popup-trigger":"manual"}),G(i,e.win)),C[e.name]={target:i},setTimeout(function(){$(i).popover("show")},1)})()}else X(e.name,e.originalEvent);e.originalEvent.stopPropagation()}}function X(e,t){var a=function(e){var t;return C[e]?t=C[e].target:(t=$("#"+e).data("button"))||(e.match(/(?!-)menu$/)&&(e=e.substr(0,e.length-4)),t=$("#"+e+"-menu").data("button")),t}(e);e.match(/^drag/)?$(a).popover("dispose").remove():($(a).popover("hide"),"forwardmenu"==e&&J(t))}function Z(e){$("[aria-owns="+e+"]").popover("dispose").data("popup",null)}function ee(e){var t="mail.show.envelope",a=ge(t),n=e?!a:a,i=n?"summary":"details";a=$("div.header-content");$("div.header-links").find("a.headers-details,a.headers-summary").removeClass().addClass("headers-"+i).text(rcmail.gettext(i)),a[n?"addClass":"removeClass"]("details-view"),e&&$e(t,n)}function te(e,t){var a=$("#composestatusbar"),n=a.find("a.button.icon."+e);t?n.length||$("<a>").attr("class","button icon "+e).on("click",function(){H()}).appendTo(a):n.remove()}function ae(e,t,a){var n=$(t).parent().attr("id").replace(/^attach/,"");return $.each(["open","download","rename"],function(){var t=this;$("#attachmenu"+t,e).off("click").attr("onclick","").click(function(e){return rcmail.command(t+"-attachment",n,this,e.originalEvent)})}),rcmail.command("menu-open",{menu:"attachmentmenu",id:n},e,a)}function ne(e){var t,a,n;(e=$(e)).is(".no-menu")||e.children(".dropdown").length||(t=rcmail.gettext("options"),a=e.find("a.filename"),n=$("<a>").attr({href:"#",tabindex:a.attr("tabindex")||0,title:t,class:"button icon dropdown skip-content"}).on("click",function(e){return ae($("#attachmentmenu"),n,e)}).append($("<span>").attr("class","inner").text(t)),a.length?n.insertAfter(a):n.appendTo(e))}function ie(e,t,a,n){var i=$(t).attr("href").replace(/^mailto:/,"");return i.indexOf("@")<0||(e.find("a").off("click").removeClass("active"),rcmail.env.has_writeable_addressbook&&$(".addressbook",e).addClass("active").on("click",function(e){var a=i,n=$(t).filter(".rcmContactAddress").text();a=a.split("?")[0].split(",")[0].replace(/(^<|>$)/g,"");return n&&(a='"'+(n=n.replace("<"+a+">","")).trim()+'" <'+a+">"),rcmail.command("add-contact",a,this,e.originalEvent)}),$(".compose",e).addClass("active").on("click",function(e){return n?(t.onclick=n,$(t).trigger("click",[!0]),t.onclick=null):rcmail.command("compose",i,this,e.originalEvent),!1}),rcmail.command("menu-open",{menu:"mailto-menu",link:t},t,a.originalEvent))}function oe(e){var t=$("#quotadisplay"),a=t.find(".bar"),n=e.total?e.percent:0;0<n&&n<10&&(n=10),(a=a.length?a:$('<span class="bar"><span class="value"></span></span>').appendTo(t)).find(".value").css("width",n+"%")[90<=n?"addClass":"removeClass"]("warning"),t.attr({"data-original-title":"",title:t.find(".count").attr("title")}),e.table?t.css("cursor","pointer").data("popup-pos","top").off("click").on("click",function(t){rcmail.simple_dialog(e.table,"quota",null,{cancel_button:"close"})}):t.tooltip("dispose").tooltip({trigger:fe()?"click":"hover"})}function se(e){e=e.replace(/[,;\s]*[\r\n]+/g,",").trim();var t=[],a='(\\S+|("[^"]+"))@\\S+',n=new RegExp("(<"+a+">)"),i=new RegExp("("+a+")");a=e.match(/(?=\S)[^",;]*(?:"[^\\"]*(?:\\[,;\S][^\\"]*)*"[^",;]*)*/g);return $.each(a||[],function(){if(this.length&&(n.test(this)||i.test(this))){var a,o=this;for(e=e.replace(o,"");o.length&&0===o.indexOf(RegExp.$1)&&(a=RegExp.$1,t.push({name:"",email:a.replace(/(^<|>$)/g,"").replace(/[^a-z]$/gi,"")}),o=o.replace(a,"").trim(),n.test(o)||i.test(o)););a!=RegExp.$1&&RegExp.$1&&(a=RegExp.$1,t.push({name:o.replace(a,"").trim(),email:a.replace(/(^<|>$)/g,"")}))}}),e=e.replace(/[,;]+/,",").replace(/^[,;\s]+/,""),{recipients:t,text:e}}function re(e){var t;(e=$(e)).length&&(t=$('<div class="iframe-loader">').append($('<div class="spinner spinner-border" role="status">').append($('<span class="sr-only">').text(rcmail.gettext("loading")))),e.on("load error loaded",function(){setTimeout(function(){t.remove()},500)}).parent().append(t),k&&e.parent().addClass("ios-scroll"))}function le(e){var t,a;(e=$(e)).is(".custom-control-input")||((a=e.attr("id"))||(a="icochk"+ ++x.checkboxes,e.attr("id",a)),e.parent().is("label")?(t=e.parent(),e=e.detach(),t.before(e)):t=$("<label>"),t.attr({for:a,class:"custom-control-label",title:e.attr("title")||""}).on("click",function(e){e.stopPropagation()}),e.addClass("form-check-input custom-control-input").wrap('<div class="custom-control custom-switch">').parent().append(t))}function ce(e){var t=$(e.row).find("input[id^=icochk]");t.length&&(e="icochk"+ ++x.checkboxes,t.attr("id",e).next("label").attr("for",e))}function de(e){var a,n,i;bw.iphone||bw.ipad||(e=$(e)).is(".pretty-select")||(a="select"+e.attr("id")+e.attr("name"),n=function(){if(e[0].ownerDocument.defaultView.$(".select-menu .listing").data("ident")==a)return!0},i=function(){var t=n();return e.popover("dispose").focus(),!t},e.addClass("pretty-select custom-select form-control").on("mousedown keydown",function(o){if(!(e=$(o.target)).prop("disabled"))return 9==o.which?(i(),!0):27==o.which||"mousedown"==o.type&&n()?i():(e.focus(),e.prop("disabled",!0),setTimeout(function(){e.prop("disabled",!1)},0),o.stopPropagation(),"mousedown"==o.type||13==o.which||32==o.which||40==o.which||63233==o.which?(function(t){var n,o=-1,s=[],r=[],l=e.closest(".ui-dialog")[0],c=(document.documentElement.clientHeight||$(document.body).height())-75,d=$(document.body).width()-20,u=Math.min(e.outerWidth(),d),p=e.val();fe()||(c*=.5),J(t),$("option",e).each(function(){var e=$(this).text(),t=$('<a href="#">').data("value",this.value).addClass(this.disabled?"disabled":"active"+(this.value==p?" selected":""));e.length?(t.text(e),r.push(this.disabled?"":e.charAt(0).toLowerCase())):(t.html("&nbsp;"),r.push("")),s.push($("<li>").append(t))});var m=$('<ul class="listing selectable iconized">').attr("data-ident",a).data("button",e[0]).append(s).on("click","a.active",function(){var t=$(this).data("value"),a=i();return e.val(t).change(),a}).on("keydown","a.active",function(e){var t,a,s,l,c="next";switch(e.which){case 27:case 9:return i();case 13:case 32:return $(this).click(),!1;case 38:case 63232:c="previous";case 40:case 63233:for(t=e.target.parentNode;t=t[c+"Sibling"];)if(l=$(t).children(".active")[0]){l.focus();break}return!1;default:(a=e.originalEvent.key)&&1==a.length&&(a=a.toLowerCase(),n!=a&&(o=-1),(-1<(s=r.indexOf(a,o+1))||-1<(s=r.indexOf(a)))&&m.find("a").eq(s).focus(),n=a,o=s)}});e.popover("dispose").popover({container:l||document.body,content:m[0],placement:"bottom",trigger:"manual",boundary:"viewport",html:!0,offset:"0,2",sanitize:!1,template:'<div class="popover select-menu" style="min-width: '+u+"px; max-width: "+d+'px"><div class="popover-header"></div><div class="popover-body" style="max-height: '+c+'px"></div></div>'}).on("shown.bs.popover",function(){e.focus(),m.parent().prev().empty().append($('<a class="button icon cancel">').text(rcmail.gettext("close")).on("click",function(e){return e.stopPropagation(),i()}));var a,s=m.find("a.selected").first();s.focus().length?(a=m.parent(),o=m.find("a").index(s[0]),n=r[o],bw.mz&&5<o&&a.scrollTop(a.scrollTop()+a.height()/2-20)):rcube_event.is_keyboard(t)&&m.find("a.active").first().focus(),m.on("mousedown",function(e){e.stopPropagation()})}).popover("show")}(o),t=(new Date).getTime(),!1):void 0)}))}function ue(e,t,a,n,i){var o=$('<div class="input-group"><input type="text" class="form-control"><span class="input-group-append"><a class="icon reset input-group-text" href="#"></a></span></div>'),s=o.find("input").attr({value:t,name:n.name+"[]",size:$(n).data("size"),title:n.title,placeholder:n.placeholder}).keydown(function(t){if(13==t.which){var a=ue(e,"",(new Date).getTime(),n,s.parent());$("input",a).focus()}else if((8==t.which||46==t.which)&&""==s.val()&&(t=s.parent(),1<e.children().length))return(t.prev().length?t.prev():t.next()).children("input").focus(),t.remove(),!1});return o.find("a.reset").click(function(){var t=$(this.parentNode.parentNode);1<e.children().length?($("input",t.next().length?t.next():t.prev()).focus(),t.remove()):$("input",t).val("").focus()}),o.find("input,a").on("focus",function(){e.addClass("focused")}).on("blur",function(){e.removeClass("focused")}),i?i.after(o):o.appendTo(e),o}function pe(e){function t(t){e.css({width:Math.max(100,t),flex:"none"})}var a=e.find(".scroller .listing").first().attr("id"),n=rcmail.env.task+"."+(a||rcmail.env.action+"."+e.attr("id")),i=(a=ge(n),e.is(".sidebar-right"));e[i?"prev":"next"]().length&&($('<div class="column-resizer">').addClass(i?"inverted":null).appendTo(e).on("mousedown",function(a){var o,s=$(this),r=e.position().left;s.addClass("active"),document.body.style.userSelect="none",$(document).on("mousemove.resizer",function(a){clearTimeout(o),o=setTimeout(function(){i&&(r=e.position().left);var n=rcube_event.get_mouse_pos(a).x;t(n=i?e.width()+(r-n):n-r)},5)}).on("mouseup.resizer",function(){$(document).off(".resizer"),$("iframe").off(".resizer"),document.body.style.userSelect="auto",s.removeClass("active"),$e(n,e.width())})}),a&&t(a))}function me(e,t,a,n){if(!fe()||!0===n)return/_task=mail/.test(e)&&/_action=get/.test(e)&&(t=!0),x.open_window.call(rcmail,e,t,a);e=rcmail.add_url(e,"_framed",1),e=rcmail.add_url(e,"_extwin",1);var i;n="",t={cancel_button:"close",width:768,height:768},a=$("<iframe>").attr({id:"windowframe",src:e});return/_action=([a-z_]+)/.test(e)&&(i=rcmail.labels[RegExp.$1])&&(n=i),/_frame=1/.test(e)&&(t.dialogClass="no-titlebar"),rcmail.simple_dialog(a,n,null,t),!0}function he(){if(w){var e=$(parent.document.documentElement);return{mode:e[0].className.match(/layout-([a-z]+)/)?RegExp.$1:g,touch:e.is(".touch")}}return{mode:g,touch:_}}function fe(){var e=he();return"phone"==e.mode||"small"==e.mode}function ve(){return he().touch}function ge(t){var a;return null!=(e=e||rcmail.local_storage_get_item("prefs.elastic",{}))[t]||null!=(a=rcmail.get_cookie(t))&&(e[t]=a,rcmail.local_storage_set_item("prefs.elastic",e)&&rcmail.set_cookie(t,a,new Date)),e[t]}function $e(t,a){var n;e[t]=a,rcmail.local_storage_set_item("prefs.elastic",e)||((n=new Date).setYear(n.getFullYear()+1),rcmail.set_cookie(t,a,n))}this.register_content_buttons=function(e){var t;x.frame_nav&&e&&e.length&&(t=x.frame_nav.children(".buttons"),y=[],$.each(e,function(){this.data("target")&&y.push(this.data("target"))}),t.html("").append(e))},this.menu_hide=X,this.menu_toggle=Q,this.menu_destroy=Z,this.popup_init=G,this.about_dialog=function(e){var t,a,n=!1,i=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about",{_framed:1})}),o=$("#supportlink");o.length&&(t=o.attr("href"))&&(n=o.text(),a=function(e){t.indexOf("mailto:")<0?window.open(t):location.href=t}),rcmail.simple_dialog(i,$(e).text(),a,{button:n,button_class:"help",cancel_button:"close",height:400})},this.headers_dialog=function(){var e={_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_framed:1};e=$("<iframe>").attr({id:"headersframe",src:rcmail.url("headers",e)});rcmail.simple_dialog(e,rcmail.gettext("arialabelmessageheaders"),null,{cancel_button:"close",height:400})},this.import_dialog=function(){var e;rcmail.commands["import-messages"]&&(e=$("#uploadform").clone(!0),rcmail.simple_dialog(e,rcmail.gettext("importmessages"),function(t){return rcmail.command("import-messages",$(e.find("form")[0]))},{button:"import",closeOnEscape:!0,minWidth:400}))},this.props_dialog=function(){var e=$("#properties-menu").clone();rcmail.simple_dialog(e,rcmail.gettext("properties"),null,{cancel_button:"close",height:400})},this.headers_show=ee,this.spellmenu=function(e){var t,a,n=[],i=rcmail.spellcheck_lang(),o=$("ul",e);if(!o.length){for(t in o=$('<ul class="selectable listing iconized" role="menu">'),rcmail.env.spell_langs)a=$('<li role="menuitem">'),$('<a href="#'+t+'" tabindex="0"></a>').text(rcmail.env.spell_langs[t]).addClass("active").data("lang",t).on("click keypress",function(e){if("keypress"!=e.type||13==rcube_event.get_keycode(e))return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spell-menu",e),!1}).appendTo(a),n.push(a);o.append(n).appendTo(e)}$("li",o).each(function(){var e=$("a",this);e.data("lang")==i?e.addClass("selected").attr("aria-selected","true"):e.hasClass("selected")&&e.removeClass("selected").removeAttr("aria-selected")})},this.searchmenu=function(e){var t,a="*",n=$('input[name="s_mods[]"]',e),i=$("#s_scope",e),o=$("#s_interval",e),s=rcmail.env.mailbox,r=rcmail.env.search_mods,l=rcmail.env.search_scope||"base";if($(e).data("initialized")||($(e).data("initialized",!0),n.length&&(n.on("change",function(){!function(e,t){var a,n=rcmail.env.task,i=rcmail.env.search_mods||{},o=rcmail.env.mailbox;i="mail"==n?(i[o]||(i[o]=rcube_clone_object(i["*"])),a=i[o],"text"):(a=i,"*"),t.checked?a[t.value]=1:delete a[t.value],t.value==i&&$('input[name="s_mods[]"]',e).not(t).map(function(){this.checked=!0,t.checked?(this.disabled=!0,delete a[this.value]):(this.disabled=!1,a[this.value]=1)}),rcmail.set_searchmods(a)}(e,this)}),rcmail.addEventListener("beforesearch",function(){rcmail.env.search_scope=i.val(),rcmail.env.search_interval=o.val()}))),i.val(l),r)if("mail"==rcmail.env.task&&(r=r[s]||r["*"],a="text"),r[a])n.map(function(){this.checked=!0,this.disabled=this.value!=a});else for(t in n.prop("disabled",!1).prop("checked",!1),r)n.filter('[value="'+t+'"]').prop("checked",!0)},this.headersmenu=function(e,t,a){$("li > a",e).each(function(){var e=$(this),t="#compose_"+e.data("target");e[$(t).is(":visible")?"removeClass":"addClass"]("active").off().on("click",function(){$(t).removeClass("hidden").find(".recipient-input input").focus(),e.removeClass("active"),rcmail.set_menu_buttons()})})},this.header_reset=function(e){$("#"+e).val("").change().closest(".form-group").nextAll(":not(.hidden)").first().find("input").focus(),$("a[data-target="+e.replace(/^_/,"")+"]").addClass("active"),rcmail.set_menu_buttons()},this.compose_status=te,this.attachmentmenu=ae,this.mailtomenu=ie,this.recipient_selector=function(e,t){function a(){i.is(":visible")&&rcmail.env.recipient_dialog.dialog("close")}t=t||{};var n=rcmail.gettext(t.title||"insertcontact"),i=$("#recipient-dialog"),o=i.parent();rcmail.env.recipient_selector_initialized||(rcmail.addEventListener("add-recipient",a),rcmail.env.recipient_selector_initialized=!0),e&&(rcmail.env.focused_field="#_"+e),rcmail.contact_list.clear_selection(),rcmail.contact_list.multiselect=!("multiselect"in t)||t.multiselect,rcmail.env.recipient_dialog=rcmail.simple_dialog(i,n,function(){if(t.action)return t.action(),void a();rcmail.command("add-recipient")},{button:rcmail.gettext(t.button||"insert"),button_class:t.button_class||"insert recipient",height:600,classes:{"ui-dialog-content":"p-0"},open:function(){$("#directorylist a").first().focus()},close:function(){i.appendTo(o),$(this).remove(),$(t.focus||rcmail.env.focused_field).focus()}})},this.show_list=B,this.show_sidebar=H,this.smart_field_init=function(e){var t=e.id+"_list",a=$('<div class="multi-input"><div class="content"></div><div class="invalid-feedback"></div></div>'),n=e.value?e.value.split("\n"):[""];$("#"+t).length||($.each(n,function(t,n){ue($(".content",a),n,0,e)}),a.attr("id",t),(e=$(e)).attr("disabled")?a.hide():e.prop("disabled",!0),e.data("hidden")&&a.hide(),e.after(a),e.hasClass("is-invalid")&&(a.addClass("is-invalid"),$(".invalid-feedback",a).text(e.data("error-msg"))))},this.smart_field_reset=function(e,t){var a=e.id+"_list",n=(t=t.length?t:[""],$("#"+a).children(".content"));n.empty(),$.each(t,function(t,a){ue(n,a,0,e)})},this.form_errors=function(e){$.each(e,function(){var e=$("#"+this[0]).addClass("is-invalid");if("list"==e.data("type"))return e.data("error-msg",this[2]),void $("#"+this[0]+"_list > .invalid-feedback").text(this[2]);e.after($('<span class="invalid-feedback">').text(this[2]))})},this.switch_nav_list=function(e){var t,a,n=$("a",e),i=$(e).next();i.height()?(i.animate({height:"0"},250),n.addClass("expand").removeClass("collapse"),$(e).removeClass("expanded")):(t=$("tr,li",i).filter(function(){return"none"!=this.style.display}),a=$(t[0]).height()||50,i.animate({height:Math.min(5,t.length)*a+1+"px"},250),n.addClass("collapse").removeClass("expand"),$(e).addClass("expanded"))},this.searchbar_init=V,this.pretty_checkbox=le,this.pretty_select=de,this.datepicker_init=function(e){window.MutationObserver&&$(e).not("[data-observed]").each(function(){var e,t=!0,a=w?parent:window;$(this).attr("data-observed","1"),w&&($(this).detach().appendTo(parent.document.body),$('<div id="ui-datepicker-div" class="hidden">').appendTo(document.body)),new MutationObserver(function(n){$.each(n,function(n,i){var o;"attributes"==i.type?(o="true"==$(i.target).attr("aria-hidden"))!=t&&(o?e&&e.remove():e=$("<div>").attr("class","ui-widget-overlay datepicker").appendTo(a.document.body).click(function(e){$(this).remove(),w&&$.datepicker._hideDatepicker()}),t=o):i.addedNodes.length&&(a.UI.bootstrap_style(i.target),w&&(a.$("select.ui-datepicker-month",i.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"M")}),a.$("select.ui-datepicker-year",i.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"Y")})))})}).observe(this,{childList:!0,subtree:!1,attributes:!0,attributeFilter:["aria-hidden"]})})},this.bootstrap_style=O,this.toggle_list_selection=function(e,t){$(e).is(".active")&&$e("list-selection",$("#"+t).toggleClass("withselection").is(".withselection"))},this.get_screen_mode=function(){return g},this.is_mobile=fe,this.is_touch=ve,A(),function(){var e;(function(){var e,t,a,n,i;"print"!=rcmail.env.action&&(e=rcmail.get_cookie("colorMode"),t=window.matchMedia("(prefers-color-scheme: dark)"),a=function(){rcmail.set_cookie("colorMode","",new Date)},n=function(){try{$(this.contentWindow.document).find("html")["dark"==b?"addClass":"removeClass"]("dark-mode")}catch(e){}},!(i=function(){"dark"==b?($("#taskmenu a.theme").removeClass("dark").addClass("light").find("span").text(rcmail.gettext("lightmode")),$("html").addClass("dark-mode")):($("#taskmenu a.theme").removeClass("light").addClass("dark").find("span").text(rcmail.gettext("darkmode")),$("html").removeClass("dark-mode")),P(g),$("iframe").each(n)})!==rcmail.env.dark_mode_support?($("#taskmenu a.theme").on("click",function(){b=$(this).is(".dark")?"dark":"light",i(),rcmail.set_cookie("colorMode",b)}),t.addListener(function(e){b=e.matches?"dark":"light",i(),a()}),e?b=e:t.matches&&(b="dark"),i(),$("iframe").on("load",n)):"dark"==e&&(a(),$("iframe").each(n)))})(),x.last_selected=$("#layout > div.selected")[0],!x.last_selected&&T.content.length&&$.each(["sidebar","list","content"],function(){if(T[this].length)return x.last_selected=T[this][0],T[this].addClass("selected"),!1}),$(window).on("resize",function(){clearTimeout(x.resize_timeout),x.resize_timeout=setTimeout(function(){R()},25)}),x.open_window=rcmail.open_window,rcmail.open_window=me,rcmail.addEventListener("message",Y).addEventListener("menu-open",Q).addEventListener("menu-close",Q).addEventListener("editor-init",S).addEventListener("autocomplete_create",D).addEventListener("googiespell_create",D).addEventListener("setquota",oe).addEventListener("enable-command",I).addEventListener("destroy-entity-selector",function(e){Z(e.name)}).addEventListener("clonerow",ce).addEventListener("init",M),(T.list.length||T.content.length)&&fe()&&(e=[],$("[data-fab]").each(function(){var t=$(this),a=t.data("fab-task")||"*",n=t.data("fab-action")||"*";"*"!=a&&a!=rcmail.env.task||"*"!=n&&n!=rcmail.env.action&&("none"!=n||rcmail.env.action)||e.push(j(t,!1,!1,!0))}),e.length&&$('<div class="floating-action-buttons">').append(e).appendTo(T.list.length?T.list:T.content)),T.sidebar.length&&pe(T.sidebar),T.list.length&&pe(T.list)}(),O(),x.got_smart_toolbar||(x.got_smart_toolbar=!0,n=[],i=[],o=he(),s=function(e,t,a){var n=$('<li role="menuitem">');(e=a?j($(e),!0,"hidden-big hidden-large"):$(e).detach()).contents().filter(function(){3==this.nodeType&&0==this.nodeValue.trim().length&&$(this).remove()}),e.is(".spacer")?n.addClass("spacer"):n.append(e),t.push(n)},T.content.find(".header > .menu").each(function(){var e=$(this);e.children().each(function(){s(this,n)}),e.remove()}),T.list.find(".header > .menu").each(function(){var e=$(this);a=e.next(),e.children().each(function(){"large"!=o.mode&&$(this).data("popup-pos","right"),s(this,n,!0),s(this,i)}),e.remove()}),$('ul[data-menu="toolbar-small"] > li > a').each(function(){var e=$(this).clone();e.attr("id",this.id+"_clone"),n.push($('<li role="menuitem">').addClass("hidden-big").append(e))}),i.length&&(l=T.list.children(".header"),c={class:"menu toolbar popupmenu listing iconized",id:"toolbar-list-menu"},d=$('<a class="button icon toolbar-list-button" href="#list-menu">').attr({"data-popup":"toolbar-list-menu"}),r=$("<ul>").attr(c).data("popup-parent",l).append(i),a.length?r.insertBefore(a):l.append(r),l.append(d)),n.length&&(l=T.content.children(".header"),c={class:"menu toolbar popupmenu listing iconized",id:"toolbar-menu"},d=$('<a class="button icon toolbar-menu-button" href="#menu">').attr({"data-popup":"toolbar-menu"}),l.append($("<ul>").attr(c).data("popup-parent",l).append(n)).append(d),T.list.find("a.toolbar-menu-button").click(function(e){e.stopPropagation(),d.click()}))),T.list.length&&(u=x.last_selected,p=function(e){"string"==typeof e&&e.length||(e=$("h1.voice").text()||$("title").text()||""),T.content.find(".header > .header-title").text(e)},m=function(e,t,a,n){var i,o,s,r,l,c;fe()&&x.frame_nav&&(i=e,(e=t).match(/_action=(create|add)/)||e.match(/_nav=hide/)?$(x.frame_nav).addClass("hide-nav-buttons"):(t=$("[data-list]",T.list).data("list"))&&(o=rcmail[t])?($(x.frame_nav).removeClass("hide-nav-buttons hidden"),(e=o.get_single_selection())&&(o.rows&&o.rows[e]&&!o.rows[e].expanded?o.expand_row(i,e):o.get_node&&(c=o.get_node(e))&&c.collapsed&&o.expand(e)),l=$("#"+rcmail.env.contentframe),c=$("a.button.next",x.frame_nav).off("click").addClass("disabled"),e=$("a.button.prev",x.frame_nav).off("click").addClass("disabled"),((r=o.get_next())||rcmail.env.current_page<rcmail.env.pagecount)&&c.removeClass("disabled").on("click",function(){x.content_lock=!0,re(l),r?o.select(r):(rcmail.env.list_uid="FIRST",rcmail.command("nextpage"))}),((s=o.get_prev())&&("*"!=s||"subscription_list"!=t)||1<rcmail.env.current_page)&&e.removeClass("disabled").on("click",function(){x.content_lock=!0,re(l),s?o.select(s):(rcmail.env.list_uid="LAST",rcmail.command("previouspage"))})):$(x.frame_nav).is(".hide-nav-buttons")&&!$(".buttons",x.frame_nav).children().length&&$(x.frame_nav).addClass("hidden")),a&&!T.content.is(":visible")?x.last_selected=T.content[0]:a||x.last_selected==u||x.content_lock||(x.last_selected=u),N(),p(n&&a?n:null),x.content_lock=!1},h=function(e){"large"!=g&&!x.content_lock&&e.force&&B(),x.content_lock=!1,e.title&&$(".header > .header-title",T.list).text(e.title)},f=function(e){var t={};"addressbook"!=rcmail.env.task&&"mail"!=rcmail.env.task||(t.force=!0),"mail"!=rcmail.env.task||rcmail.env.action||(e="string"==$.type(e)?e:rcmail.env.mailbox,e=rcmail.env.mailboxes[e],t.title=e?e.name:""),h(t)},T.content.find("iframe").on("load",function(e){var t,a="",n=!0;$(this).parent(".iframe-wrapper").scrollTop(0);try{n=!(a=(t=e.target.contentWindow).location.href).endsWith(rcmail.env.blankpage),$(t).on("unload",p)}catch(e){}m(e,a,n)}),rcmail.addEventListener("afterlist",f).addEventListener("afterlistgroup",f).addEventListener("afterlistsearch",f).addEventListener("show-list",function(e){e.force=!0,h(e)}).addEventListener("show-content",function(e){e.obj&&!$(e.obj).is("iframe")&&($(e.scrollElement||e.obj).scrollTop(0),fe()&&re(e.obj)),m(e.event||new Event,"_action="+(e.mode||"edit"),!0,e.title)})),$("[data-popup]").each(function(){G(this)}),$(document).on("click",J),rcube_webmail.set_iframe_events({mousedown:J,touchstart:J}),function(){var e,t,a=[];$.ui&&$.widget("ui.dialog",$.ui.dialog,{open:function(){return $(this.element).is(".iframe")&&(this.options.width=Math.max(576,this.options.width)),this._super(),e=this,t=$(e.uiDialog),a=t.width(),n=t.height(),i=$(window).width(),o=$(window).height(),i<=480?t.css({width:"100%",height:"100%"}):(o<n&&t.css("height","100%"),i<a&&t.css("width","100%")),$(document).click(),re($("div.popup > iframe",t)),O(e.uiDialog),this;var e,t,a,n,i,o},close:function(){return this._super(),$(".select-menu:visible").remove(),this}}),L.menu.on("click",function(){return F(!0),!1}),L.back_sidebar.on("click",function(){return H(),!1}),L.back_list.on("click",function(){return B(),!1}),L.back_content.on("click",function(){return T.list.addClass("hidden"),T.sidebar.addClass("hidden"),T.content.removeClass("hidden"),T.sidebar.removeClass("layout-sticky"),W(),x.last_selected=T.content[0],!1}),$(".searchbar").each(function(){V(this)}),!w||rcmail.env.extwin||parent.$(".ui-dialog:visible").length?w||(e=(e=T.content.find(".boxtitle").first().detach().text())||$("h1.voice").first().text())&&T.content.find(".header > .header-title").text(e):(e=$("h1.voice").first().text())&&parent.$("#layout-content > .header > .header-title:not(.constant)").text(e),w||!T.content.length||T.content.is(".no-navbar")||T.content.children(".frame-content").length||(x.frame_nav=$('<div class="footer menu toolbar content-frame-navigation hide-nav-buttons">').append($('<a class="button prev">').append($('<span class="inner"></span>').text(rcmail.gettext("previous")))).append($('<span class="buttons">')).append($('<a class="button next">').append($('<span class="inner"></span>').text(rcmail.gettext("next")))).appendTo(T.content)),$("a[data-content-button]").each(function(){a.push(j($(this)))}),$(".formbuttons").filter(function(){return!$(this).parent(".searchoptions").length}).find("button").each(function(){var e=$(this);(w||e.parents("#layout-content").length)&&(e.is(".cancel")?e.addClass("hidden"):a.push(j(e)))}),(w?parent.UI:v).register_content_buttons(a),(t=rcmail.gui_objects.messageform)&&(t=$('form[name="'+t+'"]'),$("#_cc, #_bcc, #_replyto, #_followupto",$(".compose-headers")).each(function(){$(this).on("change",function(){$("#compose"+$(this).attr("id"))[this.value?"removeClass":"addClass"]("hidden")})}),$("#compose-options").find("textarea,input,select").each(function(){var e=$("<input>").attr({type:"hidden",name:$(this).attr("name")}).appendTo(t);$(this).attr("tabindex",2).on("change",function(){e.val("checkbox"!=this.type||this.checked?$(this).val():"")}).change()})),$("[data-recipient-input]").each(function(){function e(e){return e=se(e=(e||n.val()).replace(/[,;\s]+$/,"")),$.each(e.recipients,function(){s(this.name,this.email)}),n.val(e.text),o(),0<e.recipients.length}var t,a,n,i,o,s;t=this,i="",o=function(){$(t).val(a.text()+n.val())},s=function(e,t,a){var i=$('<li class="recipient">'),r=$('<span class="name">').html(function(e){var t,a,n="",i=e.length;for('"'!=e.charAt(0)&&-1<e.indexOf('"')&&(e='"'+e.replace("\\","\\\\").replace('"','\\"')+'"'),t=0;t<i;t++)switch(a=e.charAt(t)){case'"':if(0<t&&t<i-1){n+='"';break}n+='<span class="quotes">'+a+"</span>";break;case"\\":n+='<span class="quotes">'+a+"</span>","\\"==e.charAt(t+1)&&(n+=a,t++);break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=a}return n}(e||t)).on("dblclick",function(e){var t,a,n,i;e=e,t=s,a=$(e.target).parents(".recipient"),n=a.text().replace(/,+$/,""),i=$("<input>").attr({type:"text","data-submit":"true"}).val(n),e=$("<label>").text(rcmail.gettext("recipient")).append(i),rcmail.simple_dialog(e,"recipientedit",function(){var e=i.val();if(e){if(e!=n){if(1!=(e=se(e)).recipients.length)return!1;t(e.recipients[0].name,e.recipients[0].email,a)}return!0}})}),l=$('<span class="email">'),c=$("<a>").attr({class:"button icon remove"}).click(function(){return i.remove(),o(),n.focus(),!1});e&&(t=" <"+t+">"),l.text((e?t:"")+","),i.attr("title",e?e+t:null).append([r,l,c]),a?a.replaceWith(i):i.insertBefore(n.parent()),o()},n=$("<input>").attr({type:"text",tabindex:$(t).attr("tabindex")}).on("paste change",function(t,n,i){var o,s=this.value;!1!==i&&("paste"==t.type?(i=(t.originalEvent.clipboardData||window.clipboardData).getData("text")||"",s=s.substring(0,this.selectionStart)+i+s.substring(this.selectionEnd),t.preventDefault()):n&&(o=a.find("li.recipient").last()).length&&-1<this.value.indexOf(o.text().replace(/[ ,]+$/,""))&&o.remove(),e(s))}).on("keydown",function(t){return 8!=t.keyCode||n.val().length?!((" "==t.key||","==t.key||";"==t.key||"Enter"==t.key&&!rcmail.ksearch_visible())&&e())&&void 0:(a.children("li.recipient").last().remove(),o(),!1)}).on("blur",function(){a.removeClass("focus")}).on("focus mousedown",function(){a.addClass("focus")}),a=$("<ul>").addClass("form-control recipient-input ac-input rounded-left").append($('<li class="input">').append(n)).on("mouseup",function(){i=window.getSelection().toString()}).on("click",function(){i.length||n.focus()}).sortable({appendTo:document.body,items:"> .recipient",connectWith:".recipient-input",receive:function(t,n){var i=a.text();a.find(".recipient").remove(),e(i),n.sender&&n.sender.find("input").change()}}),$(t).css({position:"absolute",opacity:0,left:"-5000px",width:"10px"}).attr("tabindex",-1).after(a).on("focus",function(e){n.focus(),e.preventDefault()}).on("change",function(){$("li.recipient",a).remove(),n.val(this.value).change()}).change(),rcmail.init_address_input_events(n)}),$(".image-upload").each(function(){function e(){var e=-1!=(n.currentSrc||n.src).indexOf(rcmail.env.photo_placeholder);$(t)[e?"removeClass":"addClass"]("changed")}var t,a,n;t=this,a=$("<a>").attr({class:"icon button delete",href:"#"}).click(function(e){return rcmail.command("delete-photo","",this,e),!1}),n=$(t).find("img")[0],$(t).append(a).click(function(){rcmail.upload_input("upload-form")}),e(),$(n).on("load",e)}),$("textarea[data-html-editor]").each(function(){var e,t,a,n,i,o,s;e=this,a=!1,n=$(e),i=n.parent(),o=$('<a class="mce-i-html" href="#" tabindex="-1"></a>').attr("title",rcmail.gettext("htmltoggle")).on("click",function(e){rcmail.command("toggle-editor",{id:n.attr("id"),html:!0},"",e.originalEvent)&&i.addClass("ishtml")}).on("keydown",function(e){if(9==e.which)return n.focus(),!1}),s=$('<div class="editor-toolbar">').append(o),i.is("td")?(t=$('input[type="checkbox"]',i.parent().next()),a=!0):t=n.next("select.hidden"),function(e){var t,a;$(e).on("input",function n(){if(!e.scrollHeight)return setTimeout(n,250);var i,o,s,r;t||(t=parseInt($(e).css("padding-top"))+parseInt($(e).css("padding-bottom"))+2,a=$(e).height()),e.scrollHeight-t<=a||(o=0,$(e).parents().each(function(){if(0<this.scrollTop)return o=(i=this).scrollTop,!1}),s=$(e).outerHeight(),$(e).outerHeight(0),r=Math.max(a,e.scrollHeight),$(e).outerHeight(s),r!==s&&$(e).height(r),o&&(i.scrollTop=o))}).trigger("input")}(e),1==t.length&&(i.addClass("html-editor"),n.after(s).data("control",t).on("keydown",function(e){e.altKey&&121==e.which&&o.focus()}),a&&(t.parents("tr").first().hide(),i.prev().hide(),i.addClass("col-sm-12")))}),$("#dragmessage-menu,#dragcontact-menu").each(function(){rcmail.gui_object("dragmenu",this.id)}),$("#taskmenu > a").each(function(){var e,t,a;/button-([a-z]+)/.test(this.className)&&(t=RegExp.$1,(a=z(this.id))&&(e=a.data)&&(e.sel&&(e.sel=e.sel.replace("button-selected","selected")+" "+t),e.act&&(e.act+=" "+t),rcmail.buttons[a.command][a.index]=e,rcmail.init_button(a.command,e)),$(this).addClass(t),$(".button-inner",this).addClass("inner")),$(this).on("mouseover",function(){rcube_webmail.long_subject_title(this,0,$("span.inner",this))})}),$(".listbutton").each(function(){var e=z(this.id);$(this).addClass("button").removeClass("listbutton"),e.data.sel&&(e.data.sel=e.data.sel.replace("listbutton","button")),e.data.act&&(e.data.act=e.data.act.replace("listbutton","button")),rcmail.buttons[e.command][e.index]=e.data,rcmail.init_button(e.command,e.data)}),$("[data-hidden]").each(function(){for(var e,t=$(this).data("hidden"),a=$(this).parent("li"),n=/(large|big|small|phone|lbs)/g;e=n.exec(t);)$(a.length?a:this).addClass("hidden-"+e[1])}),$("[data-list]").each(function(){$("input[type=checkbox]",this).each(function(){le(this)})}),w&&$(".formcontent").each(function(){$(this).next(".formbuttons").length&&$(this).parent().addClass("formcontainer")}),$("#attachment-list + a.zipdownload").appendTo(".header-links"),(k=$("html").is(".ipad,.iphone"))&&$(".iframe-wrapper, .scroller").addClass("ios-scroll"),$("html").filter(".ipad,.iphone,.webkit.mobile,.webkit.tablet").addClass("webkit-scroller").length&&$(T.menu).addClass("webkit-scroller"),$(".treelist").each(function(){function e(){$(t)[0<$(".treetoggle",t).length?"removeClass":"addClass"]("notree")}var t=this;window.MutationObserver&&new MutationObserver(e).observe(t,{childList:!0,subtree:!0}),e(),$("li.mailbox > a").on("mouseover",function(){rcube_webmail.long_subject_title_ex(this)})})}(),R()}var rcmail,rcube_webmail,bw;window.rcmail?(rcmail.show_menu=function(e,t,a){var n="object"==typeof e?e.menu:e,i=$("#"+n);return rcmail.triggerEvent(!1===t?"menu-close":"menu-open",{name:n,obj:i,props:e="string"==typeof e?{menu:n}:e,originalEvent:a})},rcmail.hide_menu=function(e,t){return rcmail.triggerEvent("menu-close",{name:e,props:{menu:e},originalEvent:t})}):(rcmail=parent.rcmail,rcube_webmail=parent.rcube_webmail,bw={});var __newInst,UI=new rcube_elastic_ui;$&&$.datepicker&&(__newInst=$.datepicker._newInst,$.extend($.datepicker,{_newInst:function(e,t){return(t=__newInst.call(this,e,t)).inline||UI.datepicker_init(t.dpDiv),t}}));